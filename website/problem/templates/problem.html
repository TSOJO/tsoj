{% extends "base.html" %}

{% block title %}Problem {{problem.id}}{% endblock %}

{% block content %}
<div class="modal fade" id="delete-confirm-modal" tabindex="-1" aria-labelledby="delete-confirm-modal-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="delete-confirm-modal-label">Confirm deletion</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this problem?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="{{ url_for('admin_bp.delete_problem', id=problem.id) }}"
                    class="btn btn-danger align-self-center">Delete</a>
            </div>
        </div>
    </div>
</div>
<div class="d-flex justify-content-between mb-1">
    <h1>{{problem.id}}: {{problem.name}}</h1>
    {% if current_user.is_contributor() %}
    <div>
        {% if problem.is_public %}
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-unlock-fill me-2"
            viewBox="0 0 16 16">
            <path
                d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2z" />
        </svg>
        {% else %}
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lock-fill me-2"
            viewBox="0 0 16 16">
            <path
                d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" />
        </svg>
        {% endif %}
        <div class="btn-group">
            <a href="{{ url_for('admin_bp.edit_problem', id=problem.id) }}"
                class="btn btn-primary align-self-center">Edit</a>
            <a data-bs-toggle="modal" data-bs-target="#delete-confirm-modal"
                class="btn btn-danger align-self-center">Delete</a>
        </div>
    </div>
    {% endif %}
</div>
<div class="row">
    <div class="col-lg-6">
        <md-block>{{problem.description}}</md-block>
        {% if example_testcases %}
        <hr>
        <h4 class="mb-0">Examples</h4>
        {% for testcase in example_testcases %}
        <div class="row">
            <div class="form-group mt-2 col-sm-6">
                <label class="form-label">Input</label>
                <div class="card">
                    <div class="card-body in-out-text" onclick="copy_text(this)" data-bs-toggle="tooltip"
                        data-bs-trigger="manual" title="Copied!">{{testcase.input}}</div>
                </div>
            </div>
            <div class="form-group mt-2 col-sm-6">
                <label class="form-label">Answer</label>
                <div class="card">
                    <div class="card-body in-out-text" onclick="copy_text(this)" data-bs-toggle="tooltip"
                        data-bs-trigger="manual" title="Copied!">{{testcase.answer}}</div>
                </div>
            </div>
        </div>
        {% endfor %}
        <div class="d-flex">
            <small class="ms-auto text-muted">Click to copy</small>
        </div>
        {% endif %}
        
        {% if problem.hints %}
        <hr>
        <div class="accordion">
            {% for hint in problem.hints %}
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{loop.index}}">
                        Hint #{{loop.index}}
                    </button>
                </h2>
                <div id="collapse{{loop.index}}" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        {{hint}}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    <div class="col-lg-6">
        <div class="d-flex align-items-center mb-2" style="gap:10px;">
            <div class="flex-grow-1">
                <h4 class="my-0">Your code</h4>
            </div>
            <div>
                <small class="my-0"><b>Time limit: </b>{{problem.time_limit / 1000}}s</small>
            </div>
            <div>
                <small class="my-0"><b>Memory limit: </b>{{problem.memory_limit / 1024}}MB</small>
            </div>
        </div>
        <div class="mb-3">
            <form method="POST" action="{{ url_for('problem_bp.problem_submit', id=problem.id) }}" id="codeForm">
                <input type="hidden" name="problem_id" value="{{problem.id}}" />
                <div class="mb-3">
                    <textarea name="user_code"></textarea>
                    <div id="editor"></div>
                </div>
                <button type="submit" class="btn btn-primary mb-3" id="submitButton"></button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{{url_for('.static', filename='problem.js')}}"></script>
{% endblock %}